
import xml.etree.ElementTree as ET
from openpyxl import Workbook

try:
    # load the XML data from file
    tree = ET.parse('xml.xml')
    root = tree.getroot()

    # create a new workbook and select the active worksheet
    workbook = Workbook()
    worksheet = workbook.active

    # create a dictionary to map Field ID to FieldDefinition names
    field_map = {}
    field_defs = root.find('Metadata/FieldDefinitions')
    if field_defs is not None:
        for field_def in field_defs.iter('FieldDefinition'):
            field_map[field_def.get('id')] = field_def.get('name')

    # write the column headers for matching FieldDefinition elements
    headers = []
    header_written = False
    for record in root.iter('Record'):
        if not header_written:
            for field in record.iter('Field'):
                if field.get('id') in field_map:
                    headers.append(field_map[field.get('id')])
            worksheet.append(headers)
            header_written = True

        row_data = []
        for field in record.iter('Field'):
            if field.text is not None:
                row_data.append(field.text)
            elif field.find('ListValues/ListValue') is not None:
                # append the ListValue text and the displayName attribute to the row data
                list_value = field.find('ListValues/ListValue')
                if field.get('id') in ['16758', '16156']:
                    row_data.append(list_value.text)
                else:
                    row_data.append(list_value.text + f" ({list_value.get('displayName')})")
            else:
                row_data.append("")  # add an empty string if the value is None
        worksheet.append(row_data)

    # save the workbook to a file
    workbook.save('output.xlsx')
except Exception as e:
    print(f"Error: {e}")

# print the root element if it was defined successfully
if 'root' in locals():
    print(f"Root element: {root}")
